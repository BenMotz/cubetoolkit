#!/bin/bash

set -e # Abort on errors

if [ $# -eq 0 ] ; then
	echo "Usage: $0 [Path to site root]"
	exit 1
fi

if [ ! -d $1 ] ; then
	echo "Error: $1 is not a directory"
	exit 1
fi

# svn export --force svn+ssh://cube@sparror.cubecinema.com/home/cube/svn-repo/TRUNK/cgi-bin/events/data/formats

TOOLKIT_PATH=$1

echo "Activate virtualenv"

source $TOOLKIT_PATH/venv/bin/activate

export PYTHONPATH=$PYTHONPATH:$TOOLKIT_PATH
export DJANGO_SETTINGS_MODULE=settings

echo "Resetting database"

python $TOOLKIT_PATH/manage.py syncdb
python $TOOLKIT_PATH/manage.py flush --noinput

echo "Importing into django"

python $TOOLKIT_PATH/import_script/import.py $TOOLKIT_PATH

echo "Done. Guessing event tags..."

python $TOOLKIT_PATH/import_script/auto_tag.py

