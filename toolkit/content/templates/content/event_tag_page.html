{% extends "base_wagtail.html" %}
{% load thumbnail_l %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block css %}
    {{ block.super }}
    {% if events %}
        {% load pipeline %}
        {% stylesheet 'programme_css_files' %}
    {% endif %}
{% endblock %}

{% block body %}
{{ block.super }}
<div>
    {% if not page.image %}
    {# No image defined #}

    <div class="grid-item grid-item--width event-image">
        &nbsp;
    </div>
    <div class="grid-item grid-item--width3">
        <h3>{{ page.title }}</h3>
        <br>
        <div class="copy event-image event_image">
            {{ page.body|richtext }}
        </div>
    </div>

    {% else %}
    <div class="grid-item grid-item--width2 event-image">
        <div class="event_image">
            {% image page.image original %}
        </div>
    </div>

    <div class="grid-item grid-item--width3">
        <h3>{{ page.title }}</h3>
        <br>
        <div class="copy event-image event_image">
            {{ page.body|richtext }}
        </div>
    </div>
    {% endif %}
</div>
<div class="programme">
{% for event, showings in events.items %}
    <div class="showing" id="event_{{ event.id }}">
        <div class="event_image">
            {% with media_item=event.media.all.0 event_slug=event.name|slugify %}{% if media_item %}
                <a href="{% url "single-event-view-with-slug" event_id=event.id event_slug=event_slug %}">
                    <img src="{{ media_item.media_file|thumbnail_url:'indexview' }}" alt="Picture for event {{ event.name }}">
                </a>
            {% endif %}
            {% if event.tags.all %}<span class="tags">{% for tag in event.tags.all %}<a href="{% url "type-view" tag.slug %}" class="tag_{{tag.name}}">{{tag.name}}</a> {% endfor %}</span>{% endif %}
        </div><!-- div event_image -->
        <a href="{% url "single-event-view-with-slug" event_id=event.id event_slug=event_slug %}">
            <p>
                <span class="pre_title">
                    {{ event.pre_title }}
                </span>
            </p>
            <h3>{{ event.name }}</h3>
            <span class="post_title">
                {{ event.post_title }}
            </span>
        </a>
        <p>
            <div class="event_details">
                <p class="start_and_pricing">
                    {% for showing in showings %}
                    {% if showing.sold_out %}<span class="sold_out">{% endif %}
                    {% if showing.cancelled %}<span class="cancelled">{% endif %}
                    {{ showing.start|date:"D j F " }}//{{ showing.start|date:" H:i" }}
                    {% if showing.cancelled %}</span> (cancelled){% endif %}
                    {% if showing.sold_out %}</span> (SOLD OUT){% endif %}
                    {% if showing.discounted %}<abbr class="discounted" title="* cheap night">*</abbr>{% endif %}<br>
                    {% endfor %}
                </p>
                <p class="copy">{{ event.copy_summary|truncatewords:16 }} [<a class="more" href="{% url "single-event-view-with-slug" event_id=event.id event_slug=event_slug %}">more</a>]</p>
            </div>{% endwith %}
    </div>{% endfor %}<!-- end .showing -->
</div><!-- end #programme -->
{% endblock %}
